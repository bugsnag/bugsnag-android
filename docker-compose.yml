version: '3.6'
services:
  android-base:
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.android-base

  android-instrumentation-tests:
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.android-instrumentation-tests
    environment:
      BROWSER_STACK_USERNAME:
      BROWSER_STACK_ACCESS_KEY:
      INSTRUMENTATION_DEVICES:
      APP_LOCATION:
      NDK_VERSION:

  android-jvm:
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.android-jvm

  android-builder:
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.android-builder
    volumes:
      - ./build:/app/build

  android-sizer:
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.android-sizer
    environment:
      DANGER_GITHUB_API_TOKEN:
      BUILDKITE:
      BUILDKITE_PULL_REQUEST_REPO:
      BUILDKITE_PULL_REQUEST:
      BUILDKITE_REPO:

  android-emulator:
    build:
      context: .
      dockerfile: dockerfiles/Dockerfile.emulator

  android-maze-runner:
    image: 855461928731.dkr.ecr.us-west-1.amazonaws.com/maze-runner-releases:latest-v3-cli
    environment:
      VERBOSE:
      DEBUG:
      BROWSER_STACK_USERNAME:
      BROWSER_STACK_ACCESS_KEY:
      MAZE_DEVICE_FARM_USERNAME:
      MAZE_DEVICE_FARM_ACCESS_KEY:
    command: --tags ~@ignore
    volumes:
      - ./build:/app/build
      - ./tests/features/:/app/features/
      - ./maze-output:/app/maze-output

networks:
  default:
    name: ${BUILDKITE_JOB_ID:-android-maze-runner}
